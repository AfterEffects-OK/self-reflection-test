この度は、アプリをご利用いただきましてありがとうございます。  
以下に、本アプリ「くりかえしテスト」の仕様書を作成しました。本仕様書は、アプリの機能、デザイン、技術的な側面を網羅し、開発者、デザイナー、テスト担当者など、関係者全員が共通理解を持てるよう、詳細かつ分かりやすく記述することを目的としています。

## 1. アプリケーション概要

### 1.1. アプリケーション名
- くりかえしテスト

### 1.2. 目的
ユーザーが科目を選択し、問題に挑戦できるWebベースのクイズアプリです。正解・不正解のフィードバック、制限時間、テスト結果の表示機能を提供します。また、管理者権限を持つユーザーは問題の追加・編集も可能で、コンテンツの柔軟な管理を実現します。

### 1.3. ターゲットユーザー
- 学習者（学生、社会人など）
- 知識の定着を図りたい方
- 自分のペースで問題を解きたい方
- 問題作成・管理に携わる教師や管理者

### 1.4. 主要機能
- **ユーザー認証**: ユーザーIDによる簡易ログイン・ログアウト機能
- **科目選択**: 複数の登録科目の中からテストを受ける科目を選択
- **クイズモード**:
    - 選択した科目からランダムに5問出題
    - 3分の制限時間
    - 問題文と選択肢（最大5つ、画像付きの可能性あり）を表示
    - 回答選択後の正誤判定とフィードバック
    - タイマー切れ時の自動終了
- **結果表示**:
    - テスト終了後のスコア表示
    - 全問の回答履歴（自分の回答と正解）の詳細表示
    - 満点時の紙吹雪演出
- **問題の追加・編集（管理者専用）**:
    - 既存科目の問題の追加・編集・削除
    - 新しい科目の作成
    - 問題文、問題画像URL、正解（テキストと画像URL）、不正解選択肢（テキストと画像URL、最大20個）の設定

---

## 2. 画面構成と機能詳細

### 2.1. ログイン画面 (#login-section)
**表示条件**: アプリケーション起動時、または「隅のログインボタン」クリック時、ログアウト時  
**要素**:
- ユーザーID入力欄: テキスト入力フィールド
- 「ログイン」ボタン: クリックでログイン処理を実行
- 「戻る」ボタン: クリックで科目選択画面へ遷移

**機能**:
- ユーザーIDを入力して「ログイン」ボタンをクリックすると、入力されたIDでログイン
- 管理者ID（admin1, admin2, 管理者）でログインした場合、問題追加・編集画面へ直接遷移
- それ以外のIDでログインした場合、科目選択画面へ遷移

### 2.2. 科目選択画面 (#subject-selection-section)
**表示条件**: ログイン後、または結果画面から「科目選択に戻る」クリック時  
**要素**:
- アプリケーションタイトル: 「くりかえしテスト」
- 「ログイン」ボタン (隅): 未ログイン時のみ表示。クリックでログイン画面へ遷移
- 科目選択ボタン群: 登録されている科目ごとにボタンが動的に生成
- 「問題を追加・編集」ボタン: 管理者ログイン時のみ表示。クリックで問題追加・編集画面へ遷移
- 「ログアウト」ボタン: ログイン時のみ表示。クリックでログアウトし、科目選択画面の未ログイン状態に戻る

**機能**:
- 各科目ボタンをクリックすると、その科目のクイズが開始される
- 問題がない科目のボタンをクリックした場合は警告が表示され、クイズは開始されない

### 2.3. 問題画面 (#question-section)
**表示条件**: 科目選択後、または「次の問題へ」クリック時  
**要素**:
- タイマー表示: 「MM:SS」形式で残り時間を表示。残り10秒以下で赤字に変化
- 問題画像: 必要に応じて表示。読み込み失敗時は非表示
- 問題文: Qn. 問題文 の形式で表示
- 選択肢ボタン群: 最大5つの選択肢がランダムな順序で表示
    - テキストと画像（必要に応じて）が表示
    - 選択済みの選択肢には「selected」スタイルが適用
    - 回答後の正解・不正解に応じて「correct」「incorrect」スタイルが適用
- フィードバックメッセージ: 回答後の正誤判定結果や、時間切れメッセージを表示
- 「回答する / 次の問題へ」ボタン:
    - 初期状態は「回答する」で、選択肢が選択されるまで無効化
    - 回答選択後、「回答する」をクリックすると正誤判定が行われ、「次の問題へ」にテキストが変更
    - 回答済み状態で「次の問題へ」をクリックすると、次の問題へ遷移。最後の問題の場合は結果画面へ遷移

**機能**:
- クイズ開始と同時にタイマーが作動し、3分カウントダウンを開始
- ユーザーが選択肢をクリックすると、その選択肢が「selected」状態になり、他の選択肢の「selected」状態が解除
- 「回答する」ボタンをクリックすると、選択した回答の正誤が判定され、フィードバックメッセージが表示
- 正解・不正解が確定した後、次の問題へ進むか、クイズを終了
- タイマーがゼロになると、クイズは自動的に終了し、結果画面へ遷移

### 2.4. 結果画面 (#result-section)
**表示条件**: クイズ終了時（全問回答後、またはタイマー切れ時）  
**要素**:
- スコア表示: 「あなたのスコア: X / Y」形式で、正解数と出題数を表示
- 結果詳細リスト: 各問題の「問題文（画像付き）」「あなたの回答（画像付き）」「正解（画像付き）」を表示。不正解だった問題は赤色で強調
- 「もう一度テストする」ボタン: クリックで、同じ科目のテストを最初から開始
- 「科目選択に戻る」ボタン: クリックで科目選択画面へ遷移

**機能**:
- テスト結果を総合スコアと問題ごとの詳細で表示
- 満点（5問すべて正解）の場合、画面に紙吹雪が舞う演出が再生

### 2.5. 問題の追加・編集画面 (#add-edit-question-section)
**表示条件**: 管理者としてログイン後、「問題を追加・編集」ボタンクリック時  
**要素**:
- 「問題の追加・編集」タイトル
- 科目選択ドロップダウン: 既存の科目を選択。「新しい科目を選択」オプションも含む
- 新しい科目名入力欄: 科目選択ドロップダウンで「新しい科目を選択」が選ばれた場合のみ表示
- 既存の問題リスト: 選択された科目（または新しい科目ではない場合）の既存の問題一覧
    - 各問題に「編集」「削除」ボタン
- 「新規問題作成」ボタン: クリックで入力フォームをリセットし、新規問題作成状態に
- 問題文入力欄: 問題のテキストを入力
- 問題画像URL入力欄: 問題の画像URLを入力（任意）
- 正解入力欄: 正解のテキストを入力
- 正解画像URL入力欄: 正解の画像URLを入力（任意）
- 不正解選択肢追加エリア
    - 不正解テキスト入力欄
    - 不正解画像URL入力欄（任意）
    - 「追加 / 更新」ボタン: 入力された不正解選択肢を追加または更新
    - 「キャンセル」ボタン: 不正解選択肢の編集をキャンセル
    - 現在の不正解選択肢リスト: 追加済みの不正解選択肢一覧
        - 各選択肢に「編集」「削除」ボタン
        - 最大20個まで追加可能
- 「問題を保存 / 更新」ボタン: 入力された問題データを保存または更新
- 「科目選択に戻る」ボタン: クリックで科目選択画面へ遷移

**機能**:
- 問題の追加: 各項目を入力し、「問題を保存」ボタンをクリックすると、選択した科目（または新しく作成した科目）に問題が追加される。最低4つの不正解選択肢が必要
- 問題の編集: 既存の問題リストから「編集」をクリックすると、その問題のデータが入力フォームに読み込まれ、「問題を保存」ボタンが「問題を更新」に変わる。編集後、「問題を更新」でデータを上書き
- 問題の削除: 既存の問題リストから「削除」をクリックすると、確認ダイアログの後、問題が削除される
- 新しい科目の作成: 「新しい科目を選択」を選び、新しい科目名を入力して問題を保存すると、その科目も追加される
- 不正解選択肢の管理: 個々の不正解選択肢の追加、編集、削除が可能
- 入力フォームのバリデーション: 必須項目が入力されているか、不正解選択肢の数が十分かなどをチェック

---

## 3. デザイン

### 3.1. 全体デザイン
- モダンでクリーンなUI: シンプルで視認性の高いデザイン
- レスポンシブデザイン: スマートフォンからPCまで、様々な画面サイズに対応
- **配色**:
    - 背景: 明るいブルーグレー（#F8FAFC）
    - コンテナ背景: 白（#ffffff）
    - 主要ボタン: 青系統（例: #3B82F6）
    - フィードバック: 正解は緑系統、不正解は赤系統
    - タイトルテキスト: 青系の太字（#60A5FA）に濃い青（#2563EB）のエッジ効果
- **フォント**:
    - アプリケーションタイトル: 'Mochiy Pop P One', sans-serif（太字でエッジのあるポップなフォント）
    - その他テキスト: 'Noto Sans JP', sans-serif（可読性の高い日本語フォント）
- 丸みのある要素: ボタン、コンテナ、画像などに強めの角丸（border-radius: 1.5remなど）を適用し、親しみやすい印象
- 影の利用: コンテナやボタンに subtle な影（box-shadow）を適用し、立体感と視認性を向上

### 3.2. コンポーネントデザイン
- **ボタン**:
    - パディングを大きめに設定し、クリックしやすさを確保
    - ホバー時、アクティブ時に視覚的なフィードバック（背景色の変化、わずかなリフトアップ効果）
    - 選択肢ボタンは、テキストと画像を横並びに配置
- **画像表示**:
    - 問題画像、選択肢画像、結果詳細画像は、それぞれ適切なサイズで表示
    - 画像が読み込めない場合は、非表示になるか代替テキストが表示されるよう配慮
- **フィードバックメッセージ**:
    - 正解時には緑色、不正解時には赤色の背景とテキストで表示され、視覚的に分かりやすい
    - アイコン（✅、❌）を使用し、直感的な理解を促進
- **余白**:
    - 各セクション、特にボタンの下には、視覚的な区切りと操作性を向上させるための適切な余白が確保

---

## 4. 技術仕様

### 4.1. 使用技術
- HTML5: 構造の定義
- CSS3: スタイリング
- Tailwind CSS: クラスベースのユーティリティファーストCSSフレームワーク
- JavaScript (ES6+): アプリケーションのロジック、動的なUI操作
- Google Fonts (Mochiy Pop P One, Noto Sans JP)

### 4.2. データ構造
- **問題データ (quizDataBySubject):**
    - JavaScriptオブジェクトとしてアプリケーション内に直接定義
    - キー: 科目名 (文字列)
    - 値: 問題オブジェクトの配列
    - 各問題オブジェクトのプロパティ:
        - question: 問題文 (文字列)
        - questionImage: 問題画像のURL (文字列、任意)
        - correctAnswer: 正解オブジェクト
            - text: 正解テキスト (文字列)
            - image: 正解画像のURL (文字列、任意)
        - incorrectChoices: 不正解選択肢オブジェクトの配列 (最大20個)
            - text: 不正解テキスト (文字列)
            - image: 不正解画像のURL (文字列、任意)
- ユーザーデータ: ユーザーIDはセッション間で保持されません。管理者IDはコード内にハードコード

### 4.3. データ永続化
- なし: 現在、問題データやユーザーの回答履歴はセッション間で永続化されません。アプリケーションを閉じるとデータはリセット

### 4.4. クイズロジック
- 問題選択: 科目内の問題からランダムに5問を選出
- 選択肢生成: 正解1つと不正解の中からランダムに4つを選び、合計5つの選択肢としてシャッフルして表示
- タイマー: JavaScriptの setInterval を使用して秒単位でカウントダウン。時間切れで自動的にテスト終了
- スコア計算: テスト終了後、answeredQuestionsLog に保存された isCorrect フラグに基づいて正解数をカウント

### 4.5. エラーハンドリング
- 画像読み込みエラー: onerror イベントハンドラを使用して、画像が読み込めない場合に要素を非表示に
- フォームバリデーション: 問題追加・編集フォームで、必須入力の確認、不正解選択肢の数の確認、重複チェック（テキストのみ）など

### 4.6. パフォーマンス
- シンプルなHTML/CSS/JS構成のため、軽量で高速な動作が期待
- 画像は max-width: 100%, height: auto, object-fit: contain/cover で表示され、レイアウト崩れを防止

---

## 5. 今後の拡張性

- **データ永続化**: 問題データをLocalStorage、またはバックエンドデータベース（Node.js, Python, PHPなど）に保存し、ユーザーが追加した問題を永続化できるようにする
- **ユーザー管理**: より高度なユーザー登録・ログインシステム、パスワードによる認証、ロールベースのアクセス制御
- **クイズ設定**: 出題問題数、制限時間、ランダム出題か順次出題かなどの設定オプション
- **問題形式の多様化**: 複数選択、記述式、並べ替えなど
- **学習履歴**: 各ユーザーの学習履歴、進捗状況のトラッキング
- **出題アルゴリズム**: 苦手な問題を繰り返し出題する機能など
- **コンポーネント指向フレームワークの導入**: React, Vue, Angularなどを導入し、大規模開発や保守性を向上
